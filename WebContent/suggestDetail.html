<!DOCTYPE html>
<html>
 <head>
  	<meta charset="UTF-8">
  	<link href="main.css" type="text/css" rel="stylesheet">
  	<link href="hobbyDetail.css" type="text/css" rel="stylesheet">
    <title>WWH</title>
    <script>
    
    function getURLParams(url) {
		var result = {};
		url.replace(/[?&]{1}([^=&#]+)=([^&#]*)/g, function(s, k, v) { result[k] = decodeURIComponent(v); });
		return result;
	}
	const index = getURLParams(location.search).post_id;
    console.log(index);
    
    var postArr = JSON.parse(localStorage.getItem('postSuggest'));
    var post = null, arrIndex=null;
    for(i=0; i<postArr.length; i++) {
    	if(postArr[i].index == index) {
    		post = postArr[i];
    		arrIndex = i;
    	}
    }
	    function display () {
	    	if(post.comments.length<0) return;
	    	console.log(post)
			var divtag = "";
			for(i=0; i<post.comments.length; i++) {
				nickname = post.comments[i].writer;
				content = post.comments[i].content;
				divtag = "<div class='comment'><div class='comment-wrtier'>"+nickname+"</div><div class='comment-content'>"+content+"</div></div>";
				console.log(divtag)
				document.write(divtag);
			}
		}
	    
	    function postComment(e) {
	    	e.preventDefault();
	    	const url = window.location.href;
	    	var content = document.getElementById('content').value;
	    	if(!content) { alert("내용을 입력해주세요!"); return; }
	    	console.log(post)
	    	var commentArr = post.comments;
	    	console.log(commentArr);
	    	
	    	var comment = {
	    			writer: 'sungeun', //나중에 현재 로그인된 아이디로 수정 필요
	    			content: content,
	    	}
	    	console.log(comment);
	    	commentArr.push(comment);
	    	postArr[arrIndex].comments = commentArr;
	    	localStorage.setItem('postSuggest', JSON.stringify(postArr));
	    	window.location.replace(url);
	    }
    </script>
 </head>
<body>
<header>
    <h1><span><a href="/">WWH</a></span></h1>
    <nav>
	<ul>
		<li><a href="hobby.html"> 취미 </a></li>
		<li><a href="daily.html"> 일상 </a></li>
		<li><a href="suggest.html"> 건의사항 </a></li>
		<li><a href="#"> 마이페이지 </a></li>
		<li style="font-size:22px; margin-top:5px;"><a href="#"> 로그인 </a></li>
	</ul>
</nav>
</header>

<section>
	<article class="hobby">
		<div class="post-title" id="post-title">title</div> 
		<div style="margin-bottom:20px">
			<span id="post-writer">writer</span> | <span id="post-date">date</span>
		</div>
		<hr/>
		<br/>
		<img id="post-image" width="60%" height="50%" src=""/>
		<div id="post-content">content</div>
		<br/>
	   	<hr/>
	   	<br/>
   	</article>
   	
   	<article class="hobby">
		<div>댓글</div>
		<form onsubmit="postComment(event)" style="margin:20px 0"> 
		<textarea id="content" style="width:100%; height:50px"></textarea>
		<button type="submit" style="float:right">작성</button>
		</form>
		
		<div class="comment" >
			<script>display();</script>
		</div>
   	</article>
</section>

<script>
    	var dateArr = post.date.split('T');
	    var timeArr = dateArr[1].split(':');
	    
	    document.getElementById('post-title').innerHTML = post.title;
	    document.getElementById('post-writer').innerHTML = post.writer;
	    document.getElementById('post-date').innerHTML = dateArr[0]+"-"+timeArr[0]+":"+timeArr[1];
	    document.getElementById('post-image').src = post.image;
	    document.getElementById('post-content').innerHTML = post.content;
	    
    </script>
 <footer>
 	<p>Copyright 2021 by SungEun</p>
 </footer>
</body>
</html>